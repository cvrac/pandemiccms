<% client_cache ['Sidebar', current_locale] do %>
<%
  search_page = Page.find_by(client_id: current_client.id, template: 'search')&.decorate
  top_categories = Category.includes(:translations)
                           .where(client_id: current_client.id, posts_count: 1..)
                           .order(posts_count: :desc)
                           .limit(5)
                           .map(&:decorate)
  top_tags = Tag.includes(:translations)
                .where(client_id: current_client.id, posts_count: 1..)
                .order(posts_count: :desc)
                .limit(5)
                .map(&:decorate)
%>
<aside>
  <% if search_page %>
  <form method="get" action="<%= search_page.path(current_language) %>" class="mb-5">
    <div class="field has-addons">
      <div class="control">
        <input class="input" type="text" name="term" aria-label="<%= _('Search') %>" placeholder="<%= _('Search...') %>" />
      </div>
      <div class="control">
        <button type="submit" class="button is-info"><%= _('Search') %></button>
      </div>
    </div>
  </form>
  <% end %>
  <% if top_categories.any? %>
  <nav class="mb-5">
    <h2 class="title is-4"><%= _('Top Categories') %></h2>
    <ol class="pl-5">
      <% top_categories.each do |category| %>
      <li>
        <a href="<%= category.path(current_language) %>">
          <%= category.translate(current_locale, use_defaults: true).name %> (<%= category.posts_count %>)
        </a>
      </li>
      <% end %>
    </ol>
  </nav>
  <% end %>
  <% if top_tags.any? %>
  <nav class="mb-5">
    <h2 class="title is-4"><%= _('Top Tags') %></h2>
    <ol class="pl-5">
      <% top_tags.each do |tag| %>
      <li>
        <a href="<%= tag.path(current_language) %>">
          <%= tag.translate(current_locale, use_defaults: true).name %> (<%= tag.posts_count %>)
        </a>
      </li>
      <% end %>
    </ol>
  </nav>
  <% end %>
</aside>
<% end %>